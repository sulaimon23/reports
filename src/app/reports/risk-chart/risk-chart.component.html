<div
  class="flex flex-col items-start gap-4 px-6 py-3 bg-white rounded-xl shadow-sm border border-gray-200 w-full"
>
  <h3 class="text-md font-medium text-gray-500">Contextual Risk</h3>

  <div class="w-full flex justify-between items-start gap-5">
    <!-- Risk Statistics -->
    <div class="flex flex-col gap-5 flex-1">
      @for (stat of riskStats(); track stat.level) {
      <div class="flex items-center gap-2">
        <span
          class="flex items-center gap-2 text-sm whitespace-nowrap capitalize"
        >
          <span
            class="w-2 h-2 rounded-full inline-block"
            [ngClass]="{
              'bg-red-800': stat.colorClass === 'critical',
              'bg-red-700': stat.colorClass === 'high',
              'bg-orange-500': stat.colorClass === 'medium',
              'bg-green-700': stat.colorClass === 'low'
            }"
          ></span>
          <span class="font-bold">{{ stat.count }}</span>
          <span>{{ stat.level }}</span>
        </span>
      </div>
      }
    </div>

    <!-- Donut Chart -->
    <div class="w-36 h-36 flex-shrink-0">
      <svg
        [attr.viewBox]="'0 0 ' + chartSize + ' ' + chartSize"
        class="w-full h-full transform -rotate-90"
      >
        <!-- Background circle -->
        <circle
          [attr.cx]="chartCenter"
          [attr.cy]="chartCenter"
          [attr.r]="chartRadius"
          class="fill-none stroke-gray-200 stroke-2"
        />

        <!-- Segments -->
        @for (segment of chartSegments(); track segment.colorClass) {
        <circle
          [attr.cx]="chartCenter"
          [attr.cy]="chartCenter"
          [attr.r]="chartRadius"
          [attr.stroke-dasharray]="
            segment.percent + ' ' + (100 - segment.percent)
          "
          [attr.stroke-dashoffset]="100 - segment.offset"
          class="fill-none stroke-[4px] transition-all duration-600 ease-in-out"
          [ngClass]="{
            'stroke-red-800': segment.colorClass === 'critical',
            'stroke-red-700': segment.colorClass === 'high',
            'stroke-orange-500': segment.colorClass === 'medium',
            'stroke-green-700': segment.colorClass === 'low'
          }"
        />
        }

        <!-- Center text -->
        <text
          [attr.x]="chartCenter"
          [attr.y]="chartCenter + 2"
          class="fill-gray-700 text-xs font-semibold transform rotate-90"
          text-anchor="middle"
          dominant-baseline="middle"
          style="transform-origin: 75px 75px"
        >
          2
        </text>
      </svg>
    </div>
  </div>
</div>
